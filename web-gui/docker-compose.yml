services:
  web-gui:
    image: dgx-spark-web-gui:latest
    build:
      context: ..
      dockerfile: web-gui/Dockerfile
      args:
        # Build-time args for Vite (frontend)
        - VITE_METRICS_API_PORT=${VITE_METRICS_API_PORT:-5174}
        - VITE_MODEL_MANAGER_PORT=${VITE_MODEL_MANAGER_PORT:-5175}
        - VITE_SANDBOX_PORT=${VITE_SANDBOX_PORT:-5176}
        - VITE_SEARXNG_PORT=${VITE_SEARXNG_PORT:-8080}
    container_name: dgx-spark-web-gui
    restart: unless-stopped
    ports:
      - "5173:5173"  # Web GUI
      - "5174:5174"  # Metrics API
    environment:
      # Runtime env for metrics-api.py (backend)
      - SEARXNG_URL=${SEARXNG_URL:-http://localhost:8080}
    volumes:
      # Mount Docker socket to allow container status monitoring
      - /var/run/docker.sock:/var/run/docker.sock:ro
    network_mode: host
    privileged: true
    deploy:
      resources:
        reservations:
          devices:
            - driver: nvidia
              count: all
              capabilities: [gpu, utility]

networks:
  default:
    name: dgx-spark-network
